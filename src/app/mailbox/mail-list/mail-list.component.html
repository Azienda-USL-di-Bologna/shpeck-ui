<p-table #dt id="pec-mail-list" 
    *ngIf="mostratable && (_selectedTag || _selectedFolder || _filters)"
    [lazy]="true" 
    (onLazyLoad)="lazyLoad($event)" 
    [value]="mailListService.messages" 
    [(selection)]="mailListService.selectedMessages"
    dataKey="id" 
    [lazyLoadOnInit]="true"
    [columns]="cols" 
    [paginator]="false" 
    [loading]="loading" 
    [autoLayout]="true"
    [responsive]="true"
    [totalRecords]="mailListService.totalRecords" 
    contextMenuSelectionMode="joint" 
    selectionMode="multiple" 
    [metaKeySelection]="true" 
    [rows]="rowsNmber" 
    [rowTrackBy]="trackByFn" 
    [contextMenu]="cm" 
    [scrollable]="true"
    scrollHeight="flex"
    [virtualScroll]="true" 
    [virtualScrollDelay]="150"
    (onRowSelect)="handleEvent('onRowSelect', $event)" 
    (onRowUnselect)="handleEvent('onRowUnselect', $event)"
    (mouseenter)="handleEvent('onMouseEnter', $event)"
    (onContextMenuSelect)="handleEvent('onContextMenuSelect', $event)"
    [ngClass]="mailListService?.totalRecords > 0 ? '' : 'no-records-found'">
    <ng-template pTemplate="body" let-rowData let-message let-rowIndex="rowIndex" let-columns="columns">
        <tr #selRow 
            [attr.name]="rowData.id"
            (keydown.ArrowDown)="arrowPress('down')"
            (keydown.ArrowUp)="arrowPress('up')" 
            (focus)="onRowFocus($event, rowData)"
            [pTooltip]="message['moved'] ? message['movedInfo']: null"
            tooltipPosition="top"
            class="riga-tabella"
            [ngClass]="{
                'message-row-font-size-small': fontSize === 'small',
                'message-row-font-size-medium': fontSize === 'medium',
                'message-row-font-size-big': fontSize === 'big',
                'message-disabled': message['moved'] 
            }"
            [pSelectableRow]="rowData" 
            [pSelectableRowIndex]="rowIndex" 
            [pSelectableRowDisabled]="message['moved']"
            [pContextMenuRow]="rowData" 
            [pContextMenuRowDisabled]="message['moved']" 
            (dblclick)="openDetailPopup($event, rowData, message)"
            tabindex="-1">
            <td *ngIf="!message['moved']" class="column-checkbox" aria-hidden="true">
                <p-tableCheckbox [value]="rowData" aria-hidden="true"></p-tableCheckbox>
            </td>
            <td *ngIf="message['moved']" class="column-checkbox" aria-hidden="true">
            </td>
            <td class="row-main-content" role="cell">
                <div class="mail-icons-container">
                    <span class="prima-riga-sinistra" aria-hidden="true">
                        <!-- ICONE AZIONE -->
                        <!-- protocollato-->
                        <span class="mail-icon first-icon-left">
                            <ng-template #registrationTemplate let-registrationstatus>
                                <i
                                    [pTooltip]="message['moved'] ? null :
                                                registrationstatus === 'REGISTERED' ? 'Vedi dettaglio protocollazione' :
                                                (registrationstatus === 'REGISTRABLE' ? 'Protocolla il messaggio' : 
                                                registrationstatus === 'IN_REGISTRATION' ? 'In protocollazione' :                                                
                                                'Il messaggio non può essere protocollato')"
                                    tooltipPosition="top"
                                    class="material-icons-outlined mail-icons icon-enabled"
                                    [ngClass]="
                                    {'icon-disabled': registrationstatus === 'NOT_REGISTRABLE' || message['moved'] , 
                                    'icon-used': (registrationstatus === 'REGISTERED' || registrationstatus === 'IN_REGISTRATION') && !message['moved']}"
                                    [ngStyle]="!message['moved'] && (registrationstatus === 'REGISTERED' && {'color': 'darkcyan'} || registrationstatus === 'IN_REGISTRATION' && {'color': 'orange'})"
                                    (click)="!message['moved'] ? iconRegistrationClicked($event, message, registrationstatus): null"
                                    >
                                    {{registrationstatus === 'REGISTERED' || registrationstatus === 'IN_REGISTRATION' ? "assignment_turned_in" : "assignment"}}
                                        <!-- (registrationstatus === "REGISTRABLE" ? "assignment_returned" : "assignment_returned")}} -->
                                </i>
                                <!-- fix in_registration tag -->
                                <i *ngIf="registrationstatus === 'IN_REGISTRATION' && loggedUserIsSuperD"
                                    [pTooltip]="'Fix bug in_registration tag'"
                                    tooltipPosition="top"
                                    class="material-icons mail-icons icon-enabled mi-fist-line"
                                    (click)="onFixMessageTagInRegistration($event, message)">adjust
                                </i>
                                
                            </ng-template>
                            <ng-template [ngTemplateOutlet]="registrationTemplate"
                                [ngTemplateOutletContext]="{$implicit: getRegistrationStatus(message)}">
                            </ng-template>
                            <p-contextMenu
                                appendTo="body" 
                                (onShow)="tagsMenuStatus('registerMenuOpened')" 
                                #registrationMenu
                                [model]="aziendeProtocollabiliSubCmItems">
                            </p-contextMenu>
                            <!-- questo è un menu alternativo usato per il 'protocolla ancora' -->
                            <p-menu 
                                appendTo="body"
                                (onShow)="tagsMenuStatus('registerMenuOpened')"
                                [popup]="true" 
                                #alternativeMenu
                                [model]="aziendeProtocollabiliSubCmItems">   
                            </p-menu>
                        </span>
                        <!-- reindirizzato -->
                        <span class="mail-icon">
                            <ng-template  #readdressTemplate let-readdressstatus>
                                <i [pTooltip]=" message['moved'] ? null :
                                                readdressstatus === 'NOT_READDRESSABLE' ? 'Il messaggio non può essere reindirizzato' :
                                                readdressstatus === 'READDRESSABLE' ? 'Reindirizza il messaggio' : 'Vedi dettagli reindirizzamento'"
                                    tooltipPosition="top"
                                    class="material-icons mail-icons icon-enabled"
                                    [ngClass]="{
                                        'icon-disabled': readdressstatus === 'NOT_READDRESSABLE' || message['moved'], 
                                        'icon-used': (readdressstatus !== 'NOT_READDRESSABLE' && readdressstatus !== 'READDRESSABLE') && !message['moved']}"
                                    [ngStyle]="!message['moved'] && (readdressstatus === 'FULL_READDRESSED' ||
                                        readdressstatus === 'READDRESSED_IN' ||
                                        readdressstatus === 'READDRESSED_OUT') && {'color': 'darkcyan'}"
                                    (click)="!message['moved'] ? iconReaddressClicked($event, message, readdressstatus): null">
                                    low_priority
                                <!--  {{readdressstatus === 'NOT_READDRESSABLE' ? 'call_split' :
                                        readdressstatus === 'READDRESSABLE' ? 'call_split' : 'low_priority'}} -->
                                </i>
                            </ng-template>
                            <ng-template [ngTemplateOutlet]="readdressTemplate"
                                [ngTemplateOutletContext]="{$implicit: getReaddressStatus(message)}">
                            </ng-template>
                        </span>
                        <!-- annotato -->
                        <span class="mail-icon">
                            <ng-template  #annotatedTemplate let-annotatedstatus>
                                <i  [pTooltip]="message['moved'] ? null :
                                                annotatedstatus ? 'Visualizza la nota' : 'Aggiungi una nota'"
                                    tooltipPosition="top"
                                    class="material-icons-outlined mail-icons icon-enabled"
                                    [ngStyle]="annotatedstatus && {'color': 'darkcyan'}"
                                    [ngClass] = "{'message-disabled': message['moved']}"
                                    (click)="!message['moved'] ? noteHandler(message): null">
                                    {{annotatedstatus ? "insert_drive_file" : "note_add"}}
                                </i>
                            </ng-template>
                            <ng-template [ngTemplateOutlet]="annotatedTemplate"
                                [ngTemplateOutletContext]="{$implicit: isAlreadyTagged(message, 'annotated')}">
                            </ng-template>
                        </span>
                        <!-- fascicolato -->
                        <span class="mail-icon fa-icon">
                            <ng-template  #archivedTemplate let-archivedstatus>
                                <i  [pTooltip]="message['moved'] ? null :
                                                archivedstatus === 'ARCHIVED' ? 'Vedi dettaglio fascicolazione' :
                                                (archivedstatus === 'ARCHIVABLE' ? 'Fascicola il messaggio' : 
                                                (archivedstatus=== 'TEMPORARILY_NOT_ARCHIVABLE' ? 'Pec non ancora disponibile per la fasciolazione diretta, riprovare più tardi' : 
                                                'Il messaggio non può essere fascicolato'))"
                                    tooltipPosition="top"
                                    class="fa fa-server fa-rotate-270 mail-icons icon-enabled"
                                    [ngClass]="{
                                        'icon-disabled': archivedstatus === 'NOT_ARCHIVABLE' || archivedstatus === 'TEMPORARILY_NOT_ARCHIVABLE' || message['moved'], 
                                        'icon-used': archivedstatus === 'ARCHIVED'}"
                                    [ngStyle]="(archivedstatus === 'ARCHIVED'  && !message['moved']) && {'color': 'darkcyan'}"
                                    (click)="!message['moved'] ? iconArchiveClicked($event, message, archivedstatus): null"
                                    >
                                </i>
                                <!-- <p-contextMenu 
                                    appendTo="body" 
                                    (onShow)="tagsMenuStatus('archiveMenuOpened')" 
                                    #archiviationMenu 
                                    [model]="aziendeFascicolabiliSubCmItems">
                                </p-contextMenu> -->
                                <p-menu 
                                    appendTo="body"
                                    (onShow)="tagsMenuStatus('archiveMenuOpened')"
                                    [popup]="true" 
                                    #archiviationMenu
                                    [model]="aziendeFascicolabiliSubCmItems">   
                                </p-menu>
                            </ng-template>
                            <ng-template [ngTemplateOutlet]="archivedTemplate"
                                [ngTemplateOutletContext]="{$implicit: getArchiviationStatus(message)}">
                            </ng-template>
                        </span>
                        <!-- taggato -->
                        <span class="mail-icon fa-icon">
                            <ng-template  #taggedTemplate let-taggedstatus>
                                <i  [pTooltip]="message['moved'] ? null :
                                                taggedstatus ? taggedstatus.tooltip : 'Gestisci etichette'"
                                    tooltipPosition="top"
                                    class="material-icons local-offer-icon mail-icons icon-enabled mi-fist-line"
                                    [ngStyle]="taggedstatus && {'color': 'darkcyan'}"
                                    [ngClass] = "{'message-disabled': message['moved']}"
                                    (click)="!message['moved'] ? iconTaggedClicked($event, message, taggedstatus): null"
                                    >
                                </i>
                                <p-contextMenu 
                                    appendTo="body" 
                                    (onShow)="tagsMenuStatus('tagsMenuOpened')" 
                                    #tagMenu
                                    [model]="tagMenuItems" 
                                    styleClass="message-labels-icon-action">
                                </p-contextMenu>
                            </ng-template>
                            <ng-template [ngTemplateOutlet]="taggedTemplate"
                                [ngTemplateOutletContext]="{$implicit: getTaggedStatus(message)}">
                            </ng-template>
                        </span>

                        <!-- SEPARATORE -->
                        <span *ngIf="message?.iconsVisibility?.replied  ||
                            message?.iconsVisibility?.replied_all ||
                            message?.iconsVisibility?.forwarded"
                            class="separatore">|
                        </span>

                        <!-- ICONE INFORMATIVE -->
                        <!-- se c'è risposto/risposto a tutti metto quello giusto risposto a tutti vince -->
                        <span *ngIf="message?.iconsVisibility?.replied || message?.iconsVisibility?.replied_all">
                            <span class="mail-icon"
                                [ngClass]="{'visibility-hidden':!message['iconsVisibility']['replied_all'] && !message['iconsVisibility']['replied']}">
                                <i [pTooltip]=" message['moved'] ? null :
                                                getTagDescription('replied_all')" tooltipPosition="top"
                                    *ngIf="message['iconsVisibility']['replied_all']; else reply_single"
                                    class="material-icons mail-icons">reply_all</i>
                                <ng-template #reply_single><i [pTooltip]="message['moved'] ? null : getTagDescription('replied')"
                                        tooltipPosition="top" class="material-icons mail-icons">reply</i></ng-template>
                            </span>
                        </span>
                        <!-- se non c'è nè risposto, nè risposto a tutti lascio lo spazio vuoto -->
                        <span *ngIf="!message?.iconsVisibility?.replied && !message?.iconsVisibility?.replied_all"
                            class="mail-icon visibility-hidden"><i class="material-icons mail-icons">reply_all</i></span>
                        <!-- inoltra (se non c'è mette visibility-hidden per lasciare lo spazio vuoto ) -->
                        <span class="mail-icon" [ngClass]="{'visibility-hidden':!message?.iconsVisibility?.forwarded}"><i
                                [pTooltip]="message['moved'] ? null :
                                            getTagDescription('forwarded')" tooltipPosition="top"
                                class="material-icons mail-icons">forward</i></span>
                        <!-- assegnato (se non c'è mette visibility-hidden per lasciare lo spazio vuoto ) -->
                        <!-- <span class="mail-icon" [ngClass]="{'visibility-hidden':!message?.iconsVisibility?.assigned}"><i
                                [pTooltip]="getTagDescription('assigned')" tooltipPosition="top"
                                class="material-icons mail-icons">merge_type</i></span> -->
                    </span>
                    <span class="prima-riga-destra">
                        <!-- descizione inout del message -->
                        <span *ngIf="message.inOut === 'IN' && _selectedFolder?.type !== 'INBOX' && _selectedFolder?.type !== 'SENT'" class="inout-message">In arrivo</span>
                        <span *ngIf="message.inOut === 'OUT' && _selectedFolder?.type !== 'INBOX' && _selectedFolder?.type !== 'SENT'">Inviato</span>
                        <!-- iconcina degli allegati -->
                        <span class="second-line-icon" [ngClass]="{'visibility-hidden':message?.attachmentsNumber === 0}">
                            <i
                                [pTooltip]="message['moved'] ? null :
                                            message?.attachmentsNumber + ' allegati'" tooltipPosition="top"
                                class="material-icons second-line-icon">
                                attach_file
                            </i>
                        </span>
                        <!-- data della mail -->
                        <span class="mail-date"
                            [attr.aria-label]="message.receiveTime | date: 'fullDate'">
                            {{message.receiveTime | date: 'EE d MMM y, H:mm' | titlecase}}
                        </span>
                        <!-- iconcina degli errori -->
                        <span class="first-line-error icon-default-color"
                            [ngClass]="{'visibility-hidden':!(message?.iconsVisibility?.in_error ),'warn-color': message?.iconsVisibility?.in_error}">
                            <i
                                [pTooltip]="message['moved'] ? null :
                                            getTagDescription('in_error')"
                                tooltipPosition="top"
                                class="fas fa-exclamation-triangle first-line-error">
                            </i>
                        </span>
                    </span>
                </div>
                <div class="seconda-riga" [pTooltip]="'Id della pec:\n' + message['id']" [showDelay]="500" tooltipPosition="left">
                    <!-- <span class="pi pi-user icon-default-color second-line-icon"></span> -->
                    <!-- <span *ngIf="message.fromOrTo.fromOrTo === 'FROM'" title="Mittente" class="pi pi-angle-left icon-default-color second-line-icon"></span>
                    <span *ngIf="message.fromOrTo.fromOrTo === 'TO'" title="Destinatari" class="pi pi-angle-right icon-default-color second-line-icon"></span> -->

                    <div >
                        <span *ngIf="message.fromOrTo.fromOrTo === 'FROM'" title="Mittente" class="fa fa-user-edit icon-default-color second-line-icon second-line-icon-fa"></span>
                        <span *ngIf="message.fromOrTo.fromOrTo === 'TO'" title="Destinatari" class="fa fa-user-friends icon-default-color second-line-icon second-line-icon-fa"></span>
                        <div
                            class="display-text text-from-or-to" 
                            [ngClass]="{'display-bold':!message.seen}">
                            {{message.fromOrTo.description}}
                        </div>
                    </div>
                    
                    <i aria-hidden="true"
                        *ngIf="_selectedFolder?.type !== 'TRASH' && mailListService?.loggedUserCanDelete === true"
                        class="material-icons-outlined delete-icon" 
                        (click)="!message['moved']? deletingConfirmation('Sei sicuro di voler eliminare il messaggio?'): null"
                        [pTooltip]="message['moved'] ? null :
                                    'Elimina il messaggio'">
                        delete
                    </i>
                    
                </div>
                <div class="display-block extra-margin" style="overflow-x: hidden; text-overflow: ellipsis;">
                    <!-- iconcina della mail -->
                    <span *ngIf="!message?.seen" class="fas fa-envelope envelope-icon icon-default-color"></span>
                    <span *ngIf="message?.seen" class="far fa-envelope-open envelope-icon icon-default-color"></span>

                    <!-- nome della cartella in cui si trova la mail in caso di risultati di una ricerca su tutta la casella -->
                    <span *ngIf="(_filters && !_selectedFolder) || _selectedTag"
                        class="display-text text-background little-margin-left">{{message?.messageFolderList[0]?.idFolder.description}}</span>

                    <!-- oggetto della mail -->
                    <span [attr.aria-label]="'Oggetto:' + message.subject"
                        class="display-text little-margin-left" 
                        [ngClass]="{'display-bold':!message.seen}" 
                        positionStyle="absolute" 
                        [pTooltip]="message['moved'] ? null : message.subject" 
                        tooltipPosition="top" 
                        tooltipStyleClass="tooltip-oggetto-mail">
                        {{message.subject}}
                    </span>
                    <!-- <div class="display-text" [ngClass]="{'display-bold':!message.seen}">{{message.id + " -- " + message.subject}}</div>  -->
                </div>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td *ngIf="(_selectedTag || _selectedFolder || _filters)" 
                [attr.colspan]="columns.length" 
                class="flex-1 message-align flex-direction-col cella-no-elementi"> 
                <p *ngIf="_filters" style="margin: 0">Nessun elemento trovato</p>
                <p *ngIf="!_filters && _selectedFolder" style="margin: 0">La cartella selezionata non contiene elementi</p>
                <p *ngIf="!_filters && _selectedTag" style="margin: 0">L'etichetta selezionata non contiene elementi</p>
            </td>
        </tr>
    </ng-template>
</p-table>


<p-contextMenu #cm [model]="cmItems" styleClass="context-menu-mail-list"></p-contextMenu>

<!-- Questa serve per chiedere conferma all'utente sul dove vuole protocollare -->
<p-confirmDialog #cd acceptLabel="Sì" rejectLabel="No" [style]="{width: '20vw'}">
    <p-footer>
        <button type="button" pButton icon="pi pi-check" label="Sì" (click)="cd.accept()"
            class="confirm-buttons ui-button-raised ui-button-secondary custom-secondary-button">
        </button>
        <button type="button" pButton icon="pi pi-times " label="No" (click)="cd.reject()"
            class="confirm-buttons ui-button-raised ui-button-secondary custom-secondary-button">
        </button>
    </p-footer>
</p-confirmDialog>


<p-dialog header="Nota messaggio" [(visible)]="displayNote" [modal]="true" [closable]="false" [responsive]="true"
    [style]="{width: '21.875rem', minWidth: '16.5rem'}" [minY]="60" [baseZIndex]="10000">
    <div class="flex-1" style="height: 100%; min-height: 5rem;">
            <textarea #noteArea class="flex-1 note-area" pInputTextarea placeholder="Inserisci nota"
            [(ngModel)]="noteObject.memo"></textarea>
    </div>
    <p-footer>
        <button type="button" pButton icon="pi pi-check" (click)="handleEvent('saveNote', '')" label="Conferma"
            class="confirm-buttons ui-button-raised ui-button-secondary custom-secondary-button">
        </button>
        <button type="button" pButton icon="pi pi-times" (click)="displayNote=false" label="Annulla"
            class="confirm-buttons ui-button-raised ui-button-secondary custom-secondary-button">
        </button>
    </p-footer>
</p-dialog>


<!-- DIALOG DI PROTOCOLLAZIONE -->
<p-dialog [(visible)]="displayProtocollaDialog" [visible]="displayProtocollaDialog">
    <p-header>
        Protocolla Pec
    </p-header>
    <div style="height: 3.125rem; padding-top: 0.625rem;">
        Vuoi creare un nuovo documento, oppure aggiungere ad una bozza già creata?
    </div>
    <p-footer>
        <div class="p-grid p-justify-even">
            <button type="button" pButton (click)="chooseRegistrationType(null, 'NEW')" label="Crea Nuovo"
                class="ui-button-raised ui-button-secondary custom-secondary-button">
            </button>
            <button type="button" pButton (click)="chooseRegistrationType(null, 'ADD')"
                label="Aggiungi a bozza già creata"
                class="ui-button-raised ui-button-secondary custom-secondary-button">
            </button>
        </div>
    </p-footer>
</p-dialog>

<!-- DIALOG CHE MOSTRA IL DETTAGLIO DELLA PROTOCOLLAZIONE -->
<p-dialog [(visible)]="registrationDetail.displayRegistrationDetail">
    <p-header>
        Dettaglio protocollazione
    </p-header>
    <ul *ngIf="registrationDetail.additionalData">
        <li *ngFor="let additionalData of registrationDetail.additionalData">
            <p *ngIf="additionalData?.numeroProtocollo"><b>Il {{additionalData?.data}}:</b> {{additionalData?.descrizioneUtente}} ha protocollato il messaggio in {{additionalData?.descrizioneAzienda}}.</p>
            <p *ngIf="!additionalData?.numeroProtocollo"><b>Il {{additionalData?.data}}</b>: {{additionalData?.descrizioneUtente}} ha iniziato la protocollazione del messaggio in {{additionalData?.descrizioneAzienda}}.</p>
            <p *ngIf="additionalData?.numeroProtocollo">{{additionalData?.codiceRegistro}}{{additionalData?.numeroProtocollo}}/{{additionalData?.anno}}: {{additionalData?.oggetto}}</p>
            <p *ngIf="!additionalData?.numeroProtocollo">Prop. {{additionalData?.numeroProposta}}: {{additionalData?.oggetto}}</p>
            <p *ngIf="additionalData?.numeroProtocollo && additionalData?.casellaPec">Protocollata dalla casella: {{additionalData?.casellaPec}}</p>
        </li>
    </ul>
    <p-footer>
        <button *ngIf="registrationDetail.buttonRegistration"
            type="button" pButton 
            (click)="iconRegistrationClicked($event, registrationDetail.message, 'REGISTRABLE', true)" 
            label="Protocolla ancora"
            class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
        </button>
        <button type="button" pButton (click)="registrationDetail.displayRegistrationDetail = false" label="Ok"
            class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
        </button>
    </p-footer>
</p-dialog>

<!-- <button *ngIf="archiviationDetail.buttonArchivable" type="button" pButton
(click)="iconArchiveClicked($event, archiviationDetail.message, 'ARCHIVABLE')"
label="Fascicola ancora"
class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
</button>
<button type="button" pButton
(click)="archiviationDetail.displayArchiviationDetail = false"
label="Ok"
class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
</button> -->

<!-- DIALOG CHE MOSTRA IL DETTAGLIO DEL REINDIRIZZAMENTO -->
<p-dialog [(visible)]="readdressDetail.displayReaddressDetail">
    <p-header>
        Dettaglio reindirizzamenti
    </p-header>
    <li *ngIf="readdressDetail.testo?.in" [innerHTML]="readdressDetail.testo.in"></li>
    <li *ngIf="readdressDetail.testo?.out" [innerHTML]="readdressDetail.testo.out"></li>
    <p-footer class="button-centopx">
        <button *ngIf="readdressDetail.buttonReaddress" type="button" pButton
            (click)="iconReaddressClicked($event, readdressDetail.message, 'READDRESSABLE')"
            (click)="readdressDetail.displayReaddressDetail = false"
            label="Aggiungi"
            class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
        </button>
        <button type="button" pButton
            (click)="readdressDetail.displayReaddressDetail = false"
            label="Ok"
            class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
        </button>
    </p-footer>
</p-dialog>

<!-- DIALOG CHE MOSTRA IL DETTAGLIO DELLA FASCICOLAZIONE -->
<p-dialog [(visible)]="archiviationDetail.displayArchiviationDetail">
    <p-header>
        Dettaglio fascicolazioni
    </p-header>
    <div *ngIf="archiviationDetail?.additionalData">
        <div *ngFor="let d of archiviationDetail.additionalData">
            <li>
                <b>{{d.dataArchiviazione | date: 'EE d MMM y, H:mm' | titlecase}}</b>: 
                {{d.idUtente.descrizione}} ha fascicolato in 
                <span *ngIf="d.idFascicolo">{{d.idFascicolo.oggetto}} [{{d.idFascicolo.numerazioneGerarchica}}]</span>
                <span *ngIf="d.idArchivio">{{d.idArchivio.oggetto}} [{{d.idArchivio.numerazioneGerarchica}}]</span>
            </li>
        </div>
    </div>
    <p-footer>
        <button *ngIf="archiviationDetail.buttonArchivable" type="button" pButton
            (click)="iconArchiveClicked($event, archiviationDetail.message, 'ARCHIVABLE')"
            label="Fascicola ancora"
            class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
        </button>
        <button type="button" pButton
            (click)="archiviationDetail.displayArchiviationDetail = false"
            label="Ok"
            class="ui-button-raised ui-button-secondary button-styles custom-secondary-button">
        </button>
    </p-footer>
</p-dialog>

<!-- POPUP DEL DETAIL -->
<p-dialog *ngIf="displayDetailPopup" [(visible)]="displayDetailPopup" class="popup-mail-detail">
    <p-header>
        Dettaglio
    </p-header>
    <app-mail-detail [versioneAccessibile]="false"></app-mail-detail>
    <p-footer>
        <button type="button" pButton (click)="displayDetailPopup = false" label="Chiudi"
        class="ui-button-raised ui-button-secondary button-styles custom-secondary-button"></button>
    </p-footer>
</p-dialog>

<!-- POPUP AGGIUNTA TAG -->
<p-dialog *ngIf="displayNewTagPopup" [(visible)]="displayNewTagPopup" [modal]="true" [style]="{width: '26.25rem'}">
    <p-header>Nuova Etichetta</p-header>
    <form [formGroup]="tagForm">
        <span class="p-float-label" style="margin: 0.5rem 0 0.5rem 0rem;">
            <input #idtag id="float-input" type="text" size="30" formControlName="tagName" pInputText style="width: 100% !important;">
            <label for="float-input">Inserisci un nome per la nuova etichetta</label>
        </span>
        <p-footer>
            <button
                type="submit" [disabled]="tagForm.invalid"
                class="confirm-buttons ui-button-raised ui-button-secondary custom-secondary-button"
                pButton icon="fas fa-check" (click)="onNewTag(tagForm.get('tagName')?.value)" label="Crea">
            </button>
            <button
                type="button"
                class="confirm-buttons ui-button-raised ui-button-secondary custom-secondary-button"
                pButton icon="fas fa-undo-alt" (click)="displayNewTagPopup=false" label="Annulla">
            </button>
        </p-footer>
    </form>
</p-dialog>

<!-- POPUP Fascicola il messaggio -->
<p-dialog *ngIf="mailListService.displayArchivioRicerca" 
    [(visible)]="mailListService.displayArchivioRicerca"
    [modal]="true" 
    [style]="{ width: '50%'}"
    [contentStyle]="{display: 'flex', 'flex-direction': 'column', 'align-items': 'center' }"
    appendTo="body" 
    header="Fascicolazione" 
    [responsive]="false"
    [focusOnShow]="false">
    <!-- [styleClass]="'p-sm-10 p-md-4'" -->
    <div style="width: 90% !important; margin-bottom: 1rem;">
        <p>Seleziona il fascicolo/sottofascicolo:</p>
        <app-archivio-ricerca 
            #archivioRicerca 
            [idAzienda]="mailListService.idAziendaFascicolazione" 
            (archivioSelectedEvent)="archivioSelectedEvent($event.arch)">
        </app-archivio-ricerca>
    </div>
    <div style="width: 90% !important; margin-bottom: 1rem;">
        <span style="display: flex; align-items: center;">
            <p>Nome della fascicolazione:</p>
            <em *ngIf="mailListService.isDisabledNomeDocDaPec" 
                pTooltip="Non è possibile modificare il nome se la Pec è stata già fascicolata."
                class="pi pi-info-circle" style="font-size: 1.3em;  margin-left: 0.2em;">
            </em>
        </span>
            <input 
                type="text"
                [disabled]="mailListService.isDisabledNomeDocDaPec"
                [(ngModel)]="mailListService.nomeDocDaPec" 
                pInputText>
            
    </div>
    <div class="p-grid button-wrapper">
        <button 
            pButton 
            icon="pi pi-check" 
            class="button-styles" 
            label="Conferma"
            [disabled]="!archivioRicercaSelected"
            (click)="onArchivioSelectionConfirmed()">
        </button>
        <button 
            pButton 
            icon="pi pi-times" 
            class="button-styles button-margin-left" 
            label="Annulla"
            (click)="mailListService.displayArchivioRicerca = false">
        </button>
    </div>  
</p-dialog>

