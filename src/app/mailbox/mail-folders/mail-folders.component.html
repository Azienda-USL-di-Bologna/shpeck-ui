<p-tree #tree
  styleClass = "tree-style"
  [value]="mailfolders"
  selectionMode = "single"
  [(selection)]="selectedNode"
  (onNodeSelect)="handleNodeSelect('onNodeSelect', $event)"
  (onNodeUnselect)="handleNodeSelect('onNodeUnselect', $event)"
  (onNodeContextMenuSelect)="handleNodeSelect('onContextMenuSelect', $event)"
  (selectionChange)="handleNodeSelect('selectionChange', $event)"
  [contextMenu]="cm">

  <!-- temaplate del singolo nodo -->
  <ng-template let-node pTemplate="default">

    <!-- Versione nodo in modalità editing -->
    <input #folderInput [hidden] ="!!!node.editable" [attr.aria-hidden]="!!!node.editable" [(ngModel)]="node.label"
      [id]="node.key"
      type="text" 
      style="width:100%"
      class="ui-inputtext"
      aria-label="rinomina"
      (focusout)= "onLostFocus($event, folderInput.value)"
      (keyup.enter)="onEnterPressed($event, folderInput.value)"
      (keydown.esc)="onEscPressed($event)"
      [attr.disabled]="node.editable ? null : ''">

    <!-- Versione nodo in modalità sola lettura -->  
    <div #actualTarget
      aria-label="cartella"
      *ngIf="!!!node.editable" 
      [ngStyle]="{'font-style': (node.data.type ==='pec' && !node.data.data.attiva) ? 'italic' : 'normal'}"
      pTooltip="{{buildTooltipForNode(node)}}"
      tooltipPosition="top">
      {{node.label}} {{(node.data.type ==='pec' && !node.data.data.attiva) ?'- disattivata':''}}
    </div>

    <!-- Pannello del cambia colore a icona -->
    <p-overlayPanel #op appendTo="body" (onHide)="pickerOverlayHiding()">
      <div class="restore-color">
        Ripristina
        <span style="height: 0.5em; width: 0.5em;"></span>
        <i pButton type="button"  class="button-restore" (click)="ripristinaColor()" tooltipPosition="top" pTooltip="Ripristina il colore di default"></i>
      </div>
      <div>
        <p-colorPicker [(ngModel)]="color" *ngIf="pickershow" [inline]="true" appendTo="body" (onChange)="nodeColorIsActuallyChanging()"></p-colorPicker>
      </div>
      <div class="buttons-color-picker">
        <button pButton type="button" 
          class="custom-primary-button" 
          (click)="saveNewColor()" 
          label="Salva">
        </button>
        <button pButton type="button" 
          class="custom-primary-button" 
          (click)="closeColorEditing(false)" 
          label="Chiudi">
        </button>
      </div>
    </p-overlayPanel>
  </ng-template>
</p-tree>

<p-contextMenu #cm [hidden]="!(cmItems?.length > 0)" [model]="cmItems" styleClass = "context-menu-mail-folders"></p-contextMenu>
