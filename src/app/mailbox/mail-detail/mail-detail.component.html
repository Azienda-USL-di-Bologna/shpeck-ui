<div class="detail-container more-mail-selected" *ngIf="numberOfMessageSelected !== null && numberOfMessageSelected > 1">
  {{numberOfMessageSelected}} {{messageTrueDraftFalse ? 'email' : 'bozze'}} selezionate
</div>
<div class="detail-container" *ngIf="numberOfMessageSelected === null || numberOfMessageSelected <= 1">
  <h3 class="mail-object" *ngIf="fullMessage?.emlData?.subject" tabindex="0">{{fullMessage?.emlData?.subject}}</h3>
  <div *ngIf="message?.inOut === inOut?.OUT && fullMessage?.emlData?.displayBody" class="recepit-detail">
    <div class="recepit-dates">
      <li class="recepit-date">
        <span class="recepit-date-label">Accettata il:</span>
        <span class="recepit-date-content">{{fullMessage?.emlData?.acceptanceDate | date:"EEEE d MMMM y, HH:mm" | titlecase}}</span>
      </li>
      <li class="recepit-date">
        <span class="recepit-date-label">Consegnata il:</span>
        <span *ngIf="fullMessage?.emlData?.lastDeliveryDate != null; then trueBlock else  falseBlock" class="recepit-date-content"></span>
        <ng-template #trueBlock>{{fullMessage?.emlData?.lastDeliveryDate | date:"EEEE d MMMM y, HH:mm" | titlecase }}</ng-template>
        <ng-template #falseBlock> Vedi dettaglio ricevute</ng-template>
        <span *ngIf="fullMessage?.emlData?.deliveryInfo != null" class="recepit-date-content">
          {{fullMessage.emlData.deliveryInfo}}
        </span>
      </li>
    </div>
    <button *ngIf="message?.inOut === inOut?.OUT && fullMessage?.emlData?.displayBody"
      (click)="recepitsVisible = true"
      pButton style="width: 83px"
      label="Ricevute"
      class="recepits-button"
      pTooltip="Apri dettaglio ricevute">
    </button>
  </div>
  <div *ngIf="fullMessage && message?.inOut === inOut?.IN" class="recepit-detail" aria-hidden="true">
    <div class="recepit-dates">
      <li class="recepit-date">
        <span class="recepit-date-label">Ricevuto il:</span>
        <span class="recepit-date-content">{{fullMessage?.message?.createTime | date:"EEEE d MMMM y, HH:mm" | titlecase}}</span>
      </li>
      <li class="recepit-date">
        <span class="recepit-date-label">Consegnato il:</span>
        <span class="recepit-date-content"> 
          {{fullMessage && fullMessage.message && fullMessage.message['receiveTime'] ? 
            (fullMessage.message['receiveTime'] | date:"EEEE d MMMM y, HH:mm" | titlecase) : null}}
        </span>
      </li>
    </div>
  </div>
  <p-accordion [multiple]="true" class="multi-accordion-eml-detail">
      <p-accordionTab
        #dettagli
        header="Dettagli" 
        class="accordion-dettagli"
        selected = true
        [disabled]="fullMessage?.emlData == null">
        <div *ngIf="fullMessage?.emlData" class="id-date">
          <div >
            <span class="idPec" [tabindex]="this.getTabindexForAccordion(dettagli)">Id Pec: {{message?.id}}</span>
            <span class="idPec" *ngIf="message?.idMessagePecgw !== null" [tabindex]="this.getTabindexForAccordion(dettagli)">Id Pecg: {{message.idMessagePecgw}}</span>
          </div>
          <span *ngIf="fullMessage?.emlData?.sendDate" [tabindex]="this.getTabindexForAccordion(dettagli)">{{fullMessage?.emlData.sendDate | date:"EEEE d MMMM y, HH:mm" | titlecase}}</span>
        </div>

        <ul class="elenco-dettagli">
            <!-- <li *ngIf="fullMessage?.emlData?.sendDate"><span class="li-description">Inviato:</span><span class="li-content">{{getDateDisplay(fullMessage?.emlData.sendDate)}}</span></li> -->
            <li *ngIf="fullMessage?.emlData?.from">
              <div [tabindex]="this.getTabindexForAccordion(dettagli)">
                <span class="li-description">Da:</span>
                <span class="li-content indirizzo">{{fullMessage?.emlData?.from}}</span>  
              </div>
            </li>
            <li *ngIf="fullMessage?.emlData?.to && fullMessage?.emlData?.to.length > 0">
              <div [tabindex]="this.getTabindexForAccordion(dettagli)">
                <span class="li-description">A:</span>
                <span *ngFor="let t of fullMessage?.emlData?.to" class="li-content indirizzo">{{t}}</span>  
              </div>
            </li>
            <li *ngIf="fullMessage?.emlData?.cc && fullMessage?.emlData?.cc.length > 0">
              <div [tabindex]="this.getTabindexForAccordion(dettagli)">
                <span class="li-description">CC:</span>
                <span *ngFor="let c of fullMessage?.emlData?.cc" class="li-content indirizzo">{{c}}</span>
              </div>
            </li>
        </ul>
      </p-accordionTab>
      <p-accordionTab
        #allegati
        *ngIf="fullMessage?.emlData?.realAttachmentNumber > 0"
        header="Allegati"
        selected="fullMessage?.emlData?.realAttachmentNumber > 0"
        [disabled]="fullMessage?.emlData?.realAttachmentNumber == 0"
        class="accordion-allegati">
        <div class="box-allegati">
          <div *ngFor="let attachment of fullMessage?.emlData?.attachments" [tabindex]="this.getTabindexForAccordion(allegati)" (keyup.enter)="getEmlAttachment(attachment)">
            <span *ngIf="!attachment.forHtmlAttribute" class="allegato">
              <i class="far icona" [ngClass]="getFaClass(attachment)"></i>
              <span
                class="allegato-nome"
                [pTooltip]="attachment.fileName"
                tooltipPosition="top"
                tooltipStyleClass="tooltip"
                (click)="getEmlAttachment(attachment, true)">
                {{attachment.displayName}}
              </span>
              <span class="allegato-size">({{getSizeString(attachment.size)}})</span>
              <span class="allegato-scarica" (click)="getEmlAttachment(attachment)">Scarica</span>
            </span>
          </div>
        </div>
        <i *ngIf="fullMessage?.emlData?.attachments" class="far fa-file-zip icona scarica-tutti-icon"></i>
        <span *ngIf="fullMessage?.emlData?.attachments" class="scarica-tutti" (click)="getAllEmlAttachment()">Scarica tutti gli allegati</span>
        <span *ngIf="getAllEmlAttachmentInProgress">
          <p-progressSpinner
            [style]="{width: '1em', height: '1em', marginLeft: '7px'}"
            class="scarica-tutti-spinner"
            strokeWidth="8"
            fill="#FFFFFF"
            animationDuration=".5s">
          </p-progressSpinner>
        </span>
      </p-accordionTab>
  </p-accordion>
  <div class="mail-body-box" *ngIf="fullMessage?.emlData?.displayBody">
    <iframe
      #emliframe
      [srcdoc]="fullMessage?.emlData?.displayBody | sanitizeHtml"
      class="mail-body"
      (load)="customizeIframeContent()"
      frameborder="0"
      sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin">
    </iframe>
  </div>
  <div *ngIf="!fullMessage?.emlData?.displayBody" class="mail-body-box-no-anteprima mail-body-box">
    <div >Anteprima non disponibile.</div>
  </div>
</div>

<p-dialog
  header="Ricevute"
  [(visible)]="recepitsVisible"
  [responsive]="true"
  [modal]="true"
  [maximizable]="true"
  styleClass="recepit-dialog"
  appendTo="body">
  <app-recepits
    [recepits]="message?.idRelatedList">
  </app-recepits>
  <p-footer>
    <button pButton icon="pi pi-times" (click)="recepitsVisible=false" label="Chiudi" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

